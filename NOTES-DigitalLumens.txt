Getting the EPRI OpenADR VTN test server running on the latest MacOS
13 (Ventura)

----------

Note on component versions:

Upgrading from Rails 3.2.12 to 3.2.22 did not work due to a problem
with the ActiveRecord pluck() method (Array.columns method not found),
so sticking with 3.2.12.

jruby 1.7 no longer works - its OpenSSL is too out of date to
connect to rubygems.org. And the latest jruby 9.3 is not compatible
with the old Rails 3.2. Fortunately jruby 9.1 seems to work.

We need to specifically use bundler version 1.17.3, the version 2
bundler is not compatible.

torquebox is no longer supported and I couldn't easily get the old
version running. We don't need it, we're just running the server
directly on localhost. But if we need a full-blown server then
Phusion Passenger is probably the right choice.

----------

Install XCode and command line tools

Install rvm

Install java (1.8.0)

Need an older version of Postgres (versions 12+ incompatible with this
version of ActiveRecord):

mkdir -p $HOME/docker/volumes/postgres10
docker run --name postgres10 \
    -p 54320:5432 \
    -v $HOME/docker/volumes/postgres10:/var/lib/postgresql/data \
    -e POSTGRES_PASSWORD=postgres \
    -e POSTGRES_USER=postgres \
    -e PG_TRUST_LOCALNET=true \
    -d postgres:10-alpine

Copy config/database.yml.example -> config/database.yml
Update production section:

production:
  adapter: jdbcpostgresql
  database: epri_oadr
  username: postgres
  password: postgres
  host: localhost
  port: 54320

rvm install jruby-9.1

export RAILS_ENV=production

gem install bundler:1.17.3
bundle _1.17.3_ install
bundle _1.17.3_ exec rake db:setup
bundle _1.17.3_ exec rake assets:precompile

Copy config/initializers/secret_token.rb.example -> config/initializers/secret_token.rb
bundle _1.17.3_ exec rake secret
Place result in secret_token.rb

bundle _1.17.3_ exec rails s
Point browser to localhost:3000
