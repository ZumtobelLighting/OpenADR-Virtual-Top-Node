Getting the EPRI OpenADR VTN test server running on the latest MacOS
13 (Ventura)

----------

Quickstart section using docker-compose - see below sections for the details on versions

Run:

docker network create dl
docker-compose up

It will expose the application on localhost:3000 and postgres on localhost:54321. Data will persist as long as you don't
run "docker-compose down" or manually delete containers.

----------

Note on component versions:

jruby 1.7 no longer works - its OpenSSL is too out of date to
connect to rubygems.org. And the latest jruby 9.3 is not compatible
with the old Rails 3.2. Fortunately jruby 9.1 seems to work.

Rails 3.2.12 was having some issues with jruby 9.1, and the most recent
version, 3.2.22.5, seems to behave better. But ActiveRecord 3.2.22.5
was having a problem with the pluck() method and we monkey-patched it
to use the 3.2.12 implementation... See config/initializers/patches.rb.

We need to specifically use bundler version 1.17.3, the version 2
bundler is not compatible.

torquebox is no longer supported and I couldn't easily get the old
version running. We don't need it, we're just running the server
directly on localhost. But if we need a full-blown server then
Phusion Passenger is probably the right choice.

----------

Install XCode and command line tools

Install rvm

Install java (1.8.0)

Need an older version of Postgres (versions >= 10 incompatible with this
version of ActiveRecord):

mkdir -p $HOME/docker/volumes/postgres9.6
docker run --name postgres9.6 \
    -p 54321:5432 \
    -v $HOME/docker/volumes/postgres9.6:/var/lib/postgresql/data \
    -e POSTGRES_PASSWORD=postgres \
    -e POSTGRES_USER=postgres \
    -e PG_TRUST_LOCALNET=true \
    -d postgres:9.6

Copy config/database.yml.example -> config/database.yml
Update production section:

production:
  adapter: jdbcpostgresql
  database: epri_oadr
  username: postgres
  password: postgres
  host: localhost
  port: 54321

rvm install jruby-9.1

export RAILS_ENV=production

gem install bundler:1.17.3
bundle _1.17.3_ install
bundle _1.17.3_ exec rake db:setup
bundle _1.17.3_ exec rake assets:precompile

Copy config/initializers/secret_token.rb.example -> config/initializers/secret_token.rb
bundle _1.17.3_ exec rake secret
Place result in secret_token.rb

bundle _1.17.3_ exec rails s
Point browser to localhost:3000
